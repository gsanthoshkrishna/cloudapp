<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Drag and Drop Images with Persistent Properties Display</title>
<style>
    #image-container,
    #drop-container {
        border: 2px dashed #aaa;
        padding: 20px;
        margin: 20px;
        min-height: 100px;
    }

    .image-wrapper {
        position: relative;
        display: inline-block;
    }

    img {
        max-width: 100px;
        max-height: 100px;
        margin: 5px;
        cursor: pointer;
    }

    .selected {
        border: 2px solid blue;
    }

    #properties-container {
        display: none;
        border: 2px dashed #aaa;
        padding: 20px;
        margin: 20px;
        min-height: 100px;
    }
</style>
</head>
<body>

    <div id="image-container">
        {% for img in resources %}
         <img src="/static/images/{{img.res_img}}" draggable="true" ondragstart="drag(event)" alt="{{img.res_name}}">
        {% endfor %}
     </div>

<div id="drop-container" ondrop="drop(event)" ondragover="allowDrop(event)">
    Drop Here
</div>

<div id="properties-container">
    <label for="image-name">Image Name:</label>
    <input type="text" id="image-name" readonly><br><br>
    <label for="image-category">Category:</label>
    <select id="image-category">
        <option value="flower">Flower</option>
        <option value="plant">Plant</option>
        <option value="tree">Tree</option>
    </select>
</div>

<script>
let currentImage = null;

document.addEventListener('keydown', function(event) {
    if (event.key === 'Delete') {
        let selectedImages = document.querySelectorAll('.selected');
        selectedImages.forEach(image => {
            image.parentElement.removeChild(image);
        });
        document.getElementById('properties-container').style.display = 'none';
        currentImage = null;
    }
});

document.addEventListener('click', function(event) {
    const propertiesContainer = document.getElementById('properties-container');
    const dropContainer = document.getElementById('drop-container');
    
    // Check if the click is outside both the properties container and the selected image
    if (!propertiesContainer.contains(event.target) && !dropContainer.contains(event.target)) {
        propertiesContainer.style.display = 'none';
        if (currentImage) {
            currentImage.classList.remove('selected');
        }
        currentImage = null;
    }
});

function allowDrop(event) {
    event.preventDefault();
}

function drag(event) {
    event.dataTransfer.setData("text", event.target.src);
    event.dataTransfer.setData("alt", event.target.alt);
}

function drop(event) {
    event.preventDefault();
    var data = event.dataTransfer.getData("text");
    var altText = event.dataTransfer.getData("alt");

    var wrapper = document.createElement('div');
    wrapper.className = 'image-wrapper';

    var img = new Image();
    img.src = data;
    img.alt = altText;
    img.style.maxWidth = "100px";
    img.style.maxHeight = "100px";
    img.style.margin = "5px";
    img.style.cursor = "pointer";
    img.onclick = function() {
        if (currentImage) {
            currentImage.classList.remove('selected');
        }
        img.classList.toggle('selected');
        currentImage = img.classList.contains('selected') ? img : null;
        displayProperties(currentImage);
    };
    wrapper.appendChild(img);

    document.getElementById('drop-container').appendChild(wrapper);
}

function displayProperties(img) {
    if (img) {
        document.getElementById('image-name').value = img.alt;
        document.getElementById('properties-container').style.display = 'block';
    } else {
        document.getElementById('properties-container').style.display = 'none';
    }
}
</script>

</body>
</html>
